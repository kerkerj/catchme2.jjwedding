<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<title>抓寵囉</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
	
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	<link rel="stylesheet" type="text/css" href="css/main.css">

	<script type="text/javascript" src="js/shake.js"></script>
	<script type="text/javascript" src="js/util.js"></script>
</head>
<body>
	<div id="background_game2" class="container fill text-center">
		<img id="ball" src="img/ball.png">
		<div id="saso_div" class="row">
			<img id="saso" src="img/saso.png">
		</div>
		
		<div id="donz_div" class="row">
			<img id="donz" src="img/donz.png">
		</div>

		<div id="message_div" class="row">
			<h3 id="score" class="text-center">發現野生愛打電動的崇懿！</h3>
		</div>
	</div>
	<script type="text/javascript">
		var shakeThreshold = 10;

		var score = $('#score');

		var shake = 0;
		var shakeQ = 0;
		var totalShake = 0;

		var timer = null;
		var shaker = null;

		$(function(){
			setTimer();
			shaker = new Shake({
		        threshold: 10,
				timeout: 100
		    }).start();
			$(window).bind('shake', onShake);

			var ball = document.getElementById("ball");;
			prefixedEvent(ball, "AnimationEnd", onBallTransitionEnd);

			/*** TODO: call moveBall when this game start ***/
			setTimeout(moveBall, 3000);
		});

	    function onShake () {
			shake++;
			totalShake++;
			score.text("搖晃次數 " + totalShake);
			if (shake>submitThreshold) submitShake();
	    }

		function submitShake(){
			shakeQ += shake;
			shake = 0;
			var success = openUrl('shake', shakeQ);
			if (success) shakeQ = 0;
			clearTimeout(timer);
			setTimer();
		}

		function setTimer(){
			timer = setTimeout( function(){
				submitShake();
			}, 5000 );
		}

		/* Animation */

		function moveBall(){
			$('#ball').addClass('move');
			$('#score').text("開始捕捉！");
		}

		function onBallTransitionEnd() {
  			$('#score').text("開始搖晃！");
  			$('#saso').hide();
		}

		var pfx = ["webkit", "moz", "MS", "o", ""];
		function prefixedEvent(element, type, callback) {
			for (var p = 0; p < pfx.length; p++) {
				if (!pfx[p]) type = type.toLowerCase();
				element.addEventListener(pfx[p]+type, callback, false);
			}
		}

	</script>
</body>
</html>
